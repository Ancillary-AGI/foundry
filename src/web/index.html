<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="FoundryEngine - Cross-Platform Game Engine Demo">
    <meta name="keywords" content="game engine, webgl, wasm, cross-platform, foundry">
    <meta name="author" content="FoundryEngine Team">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://foundryengine.github.io/">
    <meta property="og:title" content="FoundryEngine - Cross-Platform Game Engine">
    <meta property="og:description" content="A production-ready cross-platform game engine supporting Android, Windows, macOS, iOS, and Web">
    <meta property="og:image" content="https://foundryengine.github.io/assets/preview.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://foundryengine.github.io/">
    <meta property="twitter:title" content="FoundryEngine - Cross-Platform Game Engine">
    <meta property="twitter:description" content="A production-ready cross-platform game engine supporting Android, Windows, macOS, iOS, and Web">
    <meta property="twitter:image" content="https://foundryengine.github.io/assets/preview.png">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">

    <title>FoundryEngine - Cross-Platform Game Engine</title>

    <!-- Preload critical resources -->
    <link rel="preload" href="/foundryengine.wasm" as="fetch" type="application/wasm" crossorigin>
    <link rel="preload" href="/foundryengine.js" as="script" crossorigin>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/style.css">

    <!-- Theme color for mobile browsers -->
    <meta name="theme-color" content="#000000">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FoundryEngine">

    <!-- Prevent zoom on input focus -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <!-- DNS prefetch for external resources -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//www.google-analytics.com">

    <!-- Security headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' blob:;
        style-src 'self' 'unsafe-inline';
        img-src 'self' data: blob:;
        font-src 'self';
        connect-src 'self' ws: wss:;
        media-src 'self' blob:;
        object-src 'none';
        base-uri 'self';
        form-action 'self';
        frame-ancestors 'none';
    ">
</head>
<body>
    <!-- Loading screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">
                <h1>FoundryEngine</h1>
                <p class="loading-subtitle">Cross-Platform Game Engine</p>
            </div>

            <div class="loading-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text" id="progress-text">Initializing...</div>
            </div>

            <div class="loading-details" id="loading-details">
                <div class="detail-item">
                    <span class="detail-label">Platform:</span>
                    <span class="detail-value" id="platform-info">Web</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">WebGL:</span>
                    <span class="detail-value" id="webgl-info">Detecting...</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Memory:</span>
                    <span class="detail-value" id="memory-info">Calculating...</span>
                </div>
            </div>

            <div class="loading-tips">
                <div class="tip" id="loading-tip">Loading game engine...</div>
            </div>
        </div>

        <!-- Loading animation -->
        <div class="loading-spinner">
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
        </div>
    </div>

    <!-- Main game canvas -->
    <canvas id="canvas" tabindex="0" aria-label="Game Canvas"></canvas>

    <!-- UI Overlay -->
    <div id="ui-overlay" class="ui-overlay hidden">
        <!-- Game UI will be inserted here -->
    </div>

    <!-- Debug Panel -->
    <div id="debug-panel" class="debug-panel hidden">
        <div class="debug-header">
            <h3>Debug Information</h3>
            <button id="debug-close" class="debug-close" aria-label="Close Debug Panel">×</button>
        </div>
        <div class="debug-content">
            <div class="debug-section">
                <h4>Performance</h4>
                <div class="debug-item">
                    <span class="debug-label">FPS:</span>
                    <span class="debug-value" id="debug-fps">0</span>
                </div>
                <div class="debug-item">
                    <span class="debug-label">Frame Time:</span>
                    <span class="debug-value" id="debug-frame-time">0.0 ms</span>
                </div>
                <div class="debug-item">
                    <span class="debug-label">Memory Usage:</span>
                    <span class="debug-value" id="debug-memory">0 MB</span>
                </div>
            </div>

            <div class="debug-section">
                <h4>Platform</h4>
                <div class="debug-item">
                    <span class="debug-label">Platform:</span>
                    <span class="debug-value" id="debug-platform">Web</span>
                </div>
                <div class="debug-item">
                    <span class="debug-label">User Agent:</span>
                    <span class="debug-value" id="debug-user-agent">Unknown</span>
                </div>
                <div class="debug-item">
                    <span class="debug-label">Screen Size:</span>
                    <span class="debug-value" id="debug-screen-size">0x0</span>
                </div>
            </div>

            <div class="debug-section">
                <h4>WebGL</h4>
                <div class="debug-item">
                    <span class="debug-label">Version:</span>
                    <span class="debug-value" id="debug-webgl-version">Unknown</span>
                </div>
                <div class="debug-item">
                    <span class="debug-label">Vendor:</span>
                    <span class="debug-value" id="debug-webgl-vendor">Unknown</span>
                </div>
                <div class="debug-item">
                    <span class="debug-label">Renderer:</span>
                    <span class="debug-value" id="debug-webgl-renderer">Unknown</span>
                </div>
            </div>

            <div class="debug-section">
                <h4>Controls</h4>
                <div class="debug-item">
                    <span class="debug-label">WASD:</span>
                    <span class="debug-value">Move</span>
                </div>
                <div class="debug-item">
                    <span class="debug-label">Mouse:</span>
                    <span class="debug-value">Look Around</span>
                </div>
                <div class="debug-item">
                    <span class="debug-label">Space:</span>
                    <span class="debug-value">Jump</span>
                </div>
                <div class="debug-item">
                    <span class="debug-label">F:</span>
                    <span class="debug-value">Toggle Debug</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="error-modal" class="error-modal hidden">
        <div class="error-content">
            <div class="error-icon">⚠️</div>
            <h2>Error</h2>
            <p id="error-message">An error occurred while loading the game.</p>
            <div class="error-actions">
                <button id="error-retry" class="error-button primary">Retry</button>
                <button id="error-close" class="error-button secondary">Close</button>
            </div>
        </div>
    </div>

    <!-- Mobile Controls -->
    <div id="mobile-controls" class="mobile-controls hidden">
        <!-- Virtual joystick -->
        <div class="joystick-container">
            <div class="joystick" id="virtual-joystick">
                <div class="joystick-knob" id="joystick-knob"></div>
            </div>
        </div>

        <!-- Action buttons -->
        <div class="action-buttons">
            <button class="action-button" id="jump-button" aria-label="Jump">↑</button>
            <button class="action-button" id="action-button" aria-label="Action">A</button>
        </div>
    </div>

    <!-- Instructions for desktop users -->
    <div id="instructions" class="instructions hidden">
        <div class="instructions-content">
            <h3>How to Play</h3>
            <div class="instruction-item">
                <span class="key">WASD</span>
                <span class="action">Move around</span>
            </div>
            <div class="instruction-item">
                <span class="key">Mouse</span>
                <span class="action">Look around</span>
            </div>
            <div class="instruction-item">
                <span class="key">Space</span>
                <span class="action">Jump</span>
            </div>
            <div class="instruction-item">
                <span class="key">F</span>
                <span class="action">Toggle debug info</span>
            </div>
            <button id="instructions-close" class="instructions-close">Got it!</button>
        </div>
    </div>

    <!-- Loading scripts -->
    <script src="/loading.js"></script>

    <!-- Main game script (loaded by Emscripten) -->
    <script>
        // Global error handling
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.error);
            showError('A JavaScript error occurred: ' + event.error.message);
        });

        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            showError('An unhandled error occurred: ' + event.reason);
        });

        // Show error modal
        function showError(message) {
            const errorModal = document.getElementById('error-modal');
            const errorMessage = document.getElementById('error-message');
            errorMessage.textContent = message;
            errorModal.classList.remove('hidden');
        }

        // Hide error modal
        function hideError() {
            document.getElementById('error-modal').classList.add('hidden');
        }

        // Retry loading
        function retryLoading() {
            hideError();
            location.reload();
        }

        // Setup error modal event listeners
        document.getElementById('error-retry').addEventListener('click', retryLoading);
        document.getElementById('error-close').addEventListener('click', function() {
            hideError();
        });

        // Show instructions on first visit
        if (!localStorage.getItem('foundry-instructions-seen')) {
            setTimeout(() => {
                document.getElementById('instructions').classList.remove('hidden');
            }, 2000);
        }

        document.getElementById('instructions-close').addEventListener('click', function() {
            document.getElementById('instructions').classList.add('hidden');
            localStorage.setItem('foundry-instructions-seen', 'true');
        });

        // Mobile detection
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        if (isMobile) {
            document.getElementById('mobile-controls').classList.remove('hidden');
            document.body.classList.add('mobile');
        }

        // Prevent context menu on mobile
        document.addEventListener('contextmenu', function(e) {
            if (isMobile) {
                e.preventDefault();
            }
        });

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Prevent default touch behaviors
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });

        document.addEventListener('touchmove', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });

        console.log('FoundryEngine HTML loaded successfully!');
    </script>
</body>
</html>
